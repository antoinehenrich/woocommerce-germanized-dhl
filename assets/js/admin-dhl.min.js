window.germanized=window.germanized||{},window.germanized.admin=window.germanized.admin||{},function(o){window.germanized.admin.dhl={params:{},init:function(){var e=germanized.admin.dhl;e.params=wc_gzd_admin_dhl_params,o(document).on("click","#panel-order-shipments .create-shipment-label:not(.disabled)",e.onCreateLabel).on("click","#panel-order-shipments .remove-shipment-label",e.onRemoveLabel).on("click","#panel-order-shipments .send-shipment-label",e.onSendLabel),o(document.body).on("woocommerce_gzd_shipments_needs_saving",e.onShipmentsNeedsSavingChange).on("init_tooltips",e.initTip),e.initTip()},initTip:function(){o(".create-shipment-label").tipTip({fadeIn:50,fadeOut:50,delay:200})},onShipmentsNeedsSavingChange:function(e,n,a){var i=germanized.admin.dhl,t=i.getShipment(a);n?i.disableCreateLabel(t):i.enableCreateLabel(t)},disableCreateLabel:function(e){var n=germanized.admin.dhl,a=e.find(".create-shipment-label");a.addClass("disabled button-disabled"),a.prop("title",n.params.i18n_create_label_disabled),o(document.body).trigger("init_tooltips")},enableCreateLabel:function(e){var n=germanized.admin.dhl,a=e.find(".create-shipment-label");a.removeClass("disabled button-disabled"),a.prop("title",n.params.i18n_create_label_enabled),o(document.body).trigger("init_tooltips")},getShipmentWrapperByLabel:function(e){germanized.admin.dhl;var n=o('.wc-gzd-shipment-dhl-label[data-label="'+e+'"]');return 0<n.length&&n.parents(".order-shipment:first")},getShipmentIdByLabel:function(e){germanized.admin.dhl;var n=o('.wc-gzd-shipment-dhl-label[data-label="'+e+'"]');return 0<n.length&&n.parents(".order-shipment").data("shipment")},removeLabel:function(e){var n=germanized.admin.dhl,a=n.getShipmentWrapperByLabel(e),i={action:"woocommerce_gzd_remove_dhl_label",label_id:e,security:n.params.remove_label_nonce};a&&n.doAjax(i,a)},onRemoveLabel:function(){var e=germanized.admin.dhl,n=o(this).data("label");return window.confirm(e.params.i18n_remove_label_notice)&&e.removeLabel(n),!1},sendLabel:function(e){var n=germanized.admin.dhl,a=n.getShipmentWrapperByLabel(e),i={action:"woocommerce_gzd_dhl_email_return_label",label_id:e,security:n.params.send_label_nonce};a&&n.doAjax(i,a,n.onSendLabelSuccess)},onSendLabelSuccess:function(e){var a=germanized.admin.shipments;o.each(e.messages,function(e,n){a.addNotice(n,"success")})},onSendLabel:function(){var e=germanized.admin.dhl,n=o(this).data("label");return e.sendLabel(n),!1},doAjax:function(e,n,a,i){var t=germanized.admin.dhl,r=germanized.admin.shipments,d=n.hasClass("order-shipment")?n:n.parents(".order-shipment:first"),l=d.data("shipment");a=a||t.onAjaxSuccess,i=i||t.onAjaxError,e.hasOwnProperty("security")||(e.security=t.params.edit_label_nonce),e.hasOwnProperty("shipment_id")||(e.shipment_id=l),d.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),d.find(".notice-wrapper").empty(),o.ajax({type:"POST",url:t.params.ajax_url,data:e,success:function(e){e.success?(d.unblock(),e.fragments&&o.each(e.fragments,function(e,n){o(e).replaceWith(n)}),a.apply(d,[e])):(i.apply(d,[e]),d.unblock(),e.hasOwnProperty("message")?r.addNotice(e.message,"error"):e.hasOwnProperty("messages")&&o.each(e.messages,function(e,n){r.addNotice(n,"error")}))},error:function(e){},dataType:"json"})},onAjaxSuccess:function(e){},onAjaxError:function(e){},getShipment:function(e){return o("#panel-order-shipments").find("#shipment-"+e)},onCreateLabel:function(){var e=germanized.admin.dhl,n=o(this).parents(".order-shipment").data("shipment");return e.getShipment(n).WCBackboneModal({template:"wc-gzd-modal-create-shipment-label-"+n}),!1}},o(document).ready(function(){germanized.admin.dhl.init()})}(jQuery);