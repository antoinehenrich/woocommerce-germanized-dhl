window.germanized=window.germanized||{},window.germanized.admin=window.germanized.admin||{},function(c){window.germanized.admin.dhl={params:{},init:function(){var e=germanized.admin.dhl;e.params=wc_gzd_admin_dhl_params,c(document).on("click","#panel-order-shipments .create-shipment-label",e.onCreateLabel).on("click","#panel-order-shipments .remove-shipment-label",e.onRemoveLabel).on("click",".germanized-create-label .show-further-services",e.onExpandServices).on("click",".germanized-create-label .show-fewer-services",e.onHideServices).on("change",".germanized-create-label input.show-if-trigger",e.onShowIf).on("click",".germanized-create-label .notice .notice-dismiss",e.onRemoveNotice),c(document.body).on("wc_backbone_modal_loaded",e.backbone.init).on("wc_backbone_modal_response",e.backbone.response)},onRemoveNotice:function(){c(this).parents(".notice").slideUp(150,function(){c(this).remove()})},getShipmentWrapperByLabel:function(e){germanized.admin.dhl;var n=c('.wc-gzd-shipment-dhl-label[data-label="'+e+'"]');return 0<n.length&&n.parents(".order-shipment")},getShipmentIdByLabel:function(e){germanized.admin.dhl;var n=c('.wc-gzd-shipment-dhl-label[data-label="'+e+'"]');return 0<n.length&&n.parents(".order-shipment").data("shipment")},removeLabel:function(e){var n=germanized.admin.dhl,a=n.getShipmentWrapperByLabel(e),i={action:"woocommerce_gzd_remove_dhl_label",label_id:e,security:n.params.remove_label_nonce};a&&n.doAjax(i,a)},onRemoveLabel:function(){var e=germanized.admin.dhl,n=c(this).data("label");return window.confirm(e.params.i18n_remove_label_notice)&&e.removeLabel(n),!1},doAjax:function(e,n,a,i){var r=germanized.admin.dhl,t=germanized.admin.shipments,o=n.hasClass("order-shipment")?n:n.parents(".order-shipment"),s=o.data("shipment");a=a||r.onAjaxSuccess,i=i||r.onAjaxError,e.hasOwnProperty("security")||(e.security=r.params.edit_label_nonce),e.hasOwnProperty("shipment_id")||(e.shipment_id=s),o.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),o.find(".notice-wrapper").empty(),c.ajax({type:"POST",url:r.params.ajax_url,data:e,success:function(e){e.success?(o.unblock(),e.fragments&&c.each(e.fragments,function(e,n){c(e).replaceWith(n)}),a.apply(o,[e])):(i.apply(o,[e]),o.unblock(),e.hasOwnProperty("message")?t.addNotice(e.message,"error"):e.hasOwnProperty("messages")&&c.each(e.messages,function(e,n){t.addNotice(n,"error")}))},error:function(e){},dataType:"json"})},onAjaxSuccess:function(e){},onAjaxError:function(e){},onShowIf:function(){var e=c(this).parents(".germanized-create-label").find(c(this).data("show-if")),n=c(this);0<e.length&&(n.is(":checked")?e.show():e.hide())},onExpandServices:function(){var e=c(this).parents(".germanized-create-label").find(".show-if-further-services"),n=c(this).parents(".show-services-trigger");return e.show(),n.find(".show-further-services").hide(),n.find(".show-fewer-services").show(),!1},onHideServices:function(){var e=c(this).parents(".germanized-create-label").find(".show-if-further-services"),n=c(this).parents(".show-services-trigger");return e.hide(),n.find(".show-further-services").show(),n.find(".show-fewer-services").hide(),!1},getShipment:function(e){return c("#panel-order-shipments").find("#shipment-"+e)},onCreateLabel:function(){var e=germanized.admin.dhl,n=c(this).parents(".order-shipment").data("shipment");return e.getShipment(n).WCBackboneModal({template:"wc-gzd-modal-create-shipment-label-"+n}),!1},backbone:{getShipmentId:function(e){return e.replace(/^\D+/g,"")},init:function(e,n){if(-1!==n.indexOf("wc-gzd-modal-create-shipment-label")){var a=germanized.admin.dhl.backbone,i=a.getShipmentId(n);c(document.body).trigger("wc-enhanced-select-init"),c(".germanized-create-label").find("input.show-if-trigger").trigger("change"),c(".germanized-create-label").parents(".wc-backbone-modal").on("click","#btn-ok",{shipmentId:i},a.onSubmit)}},getFormData:function(e){var a={};return c.each(e.serializeArray(),function(e,n){-1!==n.name.indexOf("[]")?(n.name=n.name.replace("[]",""),a[n.name]=c.makeArray(a[n.name]),a[n.name].push(n.value)):a[n.name]=n.value}),a},onSubmit:function(e){var a=germanized.admin.dhl.backbone,n=germanized.admin.dhl,i=c(this).parents(".wc-backbone-modal-content"),r=i.find(".germanized-create-label"),t=r.find("form"),o=a.getFormData(t);o.security=n.params.create_label_nonce,o.shipment_id=e.data.shipmentId,o.action="woocommerce_gzd_create_dhl_label",i.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),r.find(".notice-wrapper").empty(),c.ajax({type:"POST",url:n.params.ajax_url,data:o,success:function(e){e.success?(i.unblock(),e.fragments&&c.each(e.fragments,function(e,n){c(e).replaceWith(n)}),i.find(".modal-close").trigger("click")):(i.unblock(),e.hasOwnProperty("messages")&&(c.each(e.messages,function(e,n){a.addNotice(n,"error",r)}),r.animate({scrollTop:0},500)))},error:function(e){},dataType:"json"}),e.preventDefault(),e.stopPropagation()},addNotice:function(e,n,a){a.find(".notice-wrapper").append('<div class="notice is-dismissible notice-'+n+'"><p>'+e+'</p><button type="button" class="notice-dismiss"></button></div>')},response:function(e,n,a){n.indexOf("wc-gzd-modal-create-shipment-label")}}},c(document).ready(function(){germanized.admin.dhl.init()})}(jQuery);