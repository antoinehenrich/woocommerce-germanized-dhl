window.germanized=window.germanized||{},window.germanized.dhl_parcel_finder=window.germanized.dhl_parcel_finder||{},function(g,a){a.dhl_parcel_finder={params:{},init:function(){var e=a.dhl_parcel_finder;e.params=wc_gzd_dhl_parcel_finder_params,g(document).on("click",".gzd-dhl-parcel-shop-modal",e.openModal).on("click","#dhl-parcel-finder-wrapper .dhl-parcel-finder-close",e.closeModal).on("submit","#dhl-parcel-finder-wrapper #dhl-parcel-finder-form",e.onSubmit)},openModal:function(){var e=a.dhl_parcel_finder.getModal(),c=0<g(".woocommerce-checkout #shipping_country").val().length?g(".woocommerce-checkout #shipping_country").val():g(".woocommerce-checkout #billing_country").val();e.find("#dhl-parcelfinder-country").val(c);var o=0<g(".woocommerce-checkout #shipping_postcode").val().length?g(".woocommerce-checkout #shipping_postcode").val():g(".woocommerce-checkout #billing_postcode").val();e.find("#dhl-parcelfinder-postcode").val(o);var n=0<g(".woocommerce-checkout #shipping_city").val().length?g(".woocommerce-checkout #shipping_city").val():g(".woocommerce-checkout #billing_city").val();e.find("#dhl-parcelfinder-city").val(n);var r=(0<g(".woocommerce-checkout #shipping_address_1").val().length?g(".woocommerce-checkout #shipping_address_1").val():g(".woocommerce-checkout #billing_address_1").val())+" "+(0<g(".woocommerce-checkout #shipping_address_2").val().length?g(".woocommerce-checkout #shipping_address_2").val():g(".woocommerce-checkout #billing_address_2").val());return e.find("#dhl-parcelfinder-address").val(r),e.addClass("open"),e.find("#dhl-parcel-finder-form").submit(),!1},closeModal:function(){return a.dhl_parcel_finder.getModal().removeClass("open"),!1},getModal:function(){return g("#dhl-parcel-finder-wrapper")},doAjax:function(e,o,c,n){var r=a.dhl_parcel_finder;c=c||r.onAjaxSuccess,n=n||r.onAjaxError,e.hasOwnProperty("security")||(e.security=r.params.parcel_finder_nonce),o.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),o.find(".notice-wrapper").empty(),g.ajax({type:"POST",url:r.params.ajax_url,data:e,success:function(e){e.success?(o.unblock(),c.apply(o,[e])):(n.apply(o,[e]),o.unblock(),e.hasOwnProperty("message")?r.addNotice(e.message,"error",o):e.hasOwnProperty("messages")&&g.each(e.messages,function(e,c){r.addNotice(c,"error",o)}))},error:function(e){},dataType:"json"})},onAjaxSuccess:function(e){},onAjaxError:function(e){},getFormData:function(e){var o={};return g.each(e.serializeArray(),function(e,c){-1!==c.name.indexOf("[]")?(c.name=c.name.replace("[]",""),o[c.name]=g.makeArray(o[c.name]),o[c.name].push(c.value)):o[c.name]=c.value}),o},onSubmit:function(e){var c=a.dhl_parcel_finder,o=c.getModal().find("#dhl-parcel-finder"),n=o.find("form"),r=c.getFormData(n);return r.action="woocommerce_gzd_dhl_parcelfinder_search",c.doAjax(r,o,c.onSubmitSuccess),!1},onSubmitSuccess:function(e){var c=a.dhl_parcel_finder;e.parcel_shops&&c.updateMap(e.parcel_shops)},updateMap:function(e){var f=a.dhl_parcel_finder,c={lat:e[0].location.latitude,lng:e[0].location.longitude},m=new google.maps.Map(document.getElementById("dhl-parcel-finder-map"),{zoom:13,center:c}),k=[];g.each(e,function(e,c){var o,n={lat:c.location.latitude,lng:c.location.longitude},r='<h5 class="parcel_subtitle">'+f.params.opening_times+"</h5>",a=0;g.each(c.psfTimeinfos,function(e,c){if("openinghour"===c.type){switch(c.weekday){case 1:o=pr_dhl_checkout_frontend.monday;break;case 2:o=pr_dhl_checkout_frontend.tueday;break;case 3:o=pr_dhl_checkout_frontend.wednesday;break;case 4:o=pr_dhl_checkout_frontend.thrusday;break;case 5:o=pr_dhl_checkout_frontend.friday;break;case 6:o=pr_dhl_checkout_frontend.satuday;break;case 7:o=pr_dhl_checkout_frontend.sunday}a?a==c.weekday?r+=", ":r+="<br/>"+o+": ":r+=o+": ",a=c.weekday,r+=c.timefrom+" - "+c.timeto}});var t='<h5 class="parcel_subtitle">'+pr_dhl_checkout_frontend.services+"</h5>",i=": "+pr_dhl_checkout_frontend.no,d=": "+pr_dhl_checkout_frontend.no;switch(g.each(c.psfServicetypes,function(e,c){switch(c){case"parking":i=": "+pr_dhl_checkout_frontend.yes;break;case"handicappedAccess":d=": "+pr_dhl_checkout_frontend.yes}}),t+=pr_dhl_checkout_frontend.parking+i+"<br/>",t+=pr_dhl_checkout_frontend.handicap+d+"<br/>",c.shopType){case"packStation":var l=pr_dhl_checkout_frontend.packstation_icon,p=pr_dhl_checkout_frontend.packstation,h=pr_dhl_checkout_frontend.packstation;break;case"parcelShop":l=pr_dhl_checkout_frontend.parcelshop_icon,p=pr_dhl_checkout_frontend.parcelShop,h=pr_dhl_checkout_frontend.branch;break;case"postOffice":l=pr_dhl_checkout_frontend.post_office_icon,p=pr_dhl_checkout_frontend.postoffice,h=pr_dhl_checkout_frontend.branch;break;default:l=pr_dhl_checkout_frontend.packstation_icon,p=pr_dhl_checkout_frontend.packstation,h=pr_dhl_checkout_frontend.packstation}var s='<div id="parcel-content"><div id="site-notice"></div><h4 class="parcel-title">'+(p+=" "+c.primaryKeyZipRegion)+'</h4><div id="bodyContent"><div>'+c.street+" "+c.houseNo+"</br>"+c.city+" "+c.zipCode+"</div>"+r+t+'<button type="button" class="parcelshop-select-btn" id="'+c.id+'">'+pr_dhl_checkout_frontend.select+"</button></div></div>",_=new google.maps.InfoWindow({content:s,maxWidth:300});k.push(_);var u=new google.maps.Marker({position:n,map:m,title:h,animation:google.maps.Animation.DROP,icon:l});u.addListener("click",function(){!function c(){for(var e=0;e<k.length;e++)k[e].close()}(),_.open(m,u)})})},onSelectShop:function(){var n=g(this).attr("id");g.each(wc_checkout_dhl_parcelfinder.parcelShops,function(e,c){if(c.id==n){switch(c.shopType){case"packStation":var o=pr_dhl_checkout_frontend.packstation;g(".woocommerce-checkout #shipping_dhl_address_type").val("dhl_packstation").trigger("change");break;case"parcelShop":o=pr_dhl_checkout_frontend.parcelShop;g(".woocommerce-checkout #shipping_dhl_address_type").val("dhl_branch").trigger("change");break;case"postOffice":o=pr_dhl_checkout_frontend.postoffice;g(".woocommerce-checkout #shipping_dhl_address_type").val("dhl_branch").trigger("change");break;default:o=pr_dhl_checkout_frontend.packstation;g(".woocommerce-checkout #shipping_dhl_address_type").val("dhl_packstation").trigger("change")}g(".woocommerce-checkout #shipping_first_name").val(g(".woocommerce-checkout #billing_first_name").val()),g(".woocommerce-checkout #shipping_last_name").val(g(".woocommerce-checkout #billing_last_name").val()),g(".woocommerce-checkout #shipping_address_1").val(o+" "+c.primaryKeyZipRegion),g(".woocommerce-checkout #shipping_address_2").val(""),g(".woocommerce-checkout #shipping_postcode").val(c.zipCode),g(".woocommerce-checkout #shipping_city").val(c.city),g.fancybox.close()}})},addNotice:function(e,c,o){o.find(".notice-wrapper").append('<div class="notice notice-'+c+'"><p>'+e+"</p></div>")}},g(document).ready(function(){a.dhl_parcel_finder.init()})}(jQuery,window.germanized);