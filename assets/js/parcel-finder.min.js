window.germanized=window.germanized||{},window.germanized.dhl_parcel_finder=window.germanized.dhl_parcel_finder||{},function(v,c){c.dhl_parcel_finder={params:{},parcelShops:[],wrapper:"",init:function(){var a=c.dhl_parcel_finder;a.params=wc_gzd_dhl_parcel_finder_params,a.wrapper=a.params.wrapper,v(document).on("click",".gzd-dhl-parcel-shop-modal",a.openModal).on("click","#dhl-parcel-finder-wrapper .dhl-parcel-finder-close",a.closeModal).on("submit","#dhl-parcel-finder-wrapper #dhl-parcel-finder-form",a.onSubmit).on("click","#dhl-parcel-finder-wrapper .dhl-retry-search",a.onSubmit).on("click","#dhl-parcel-finder-wrapper .dhl-parcelshop-select-btn",a.onSelectShop),v(document.body).bind("woocommerce_gzd_dhl_location_available_pickup_types_changed",a.onChangeAvailablePickupTypes)},onChangeAvailablePickupTypes:function(){var a=c.dhl_parcel_finder,e=c.dhl_parcel_locator,p=a.getModal(),r=e.getShippingMethod(),n=e.getShippingMethodData(r);n&&(p.find(".finder-pickup-type").addClass("hidden"),v.each(n.supports,function(a,e){var r=p.find('.finder-pickup-type[data-pickup_type="'+e+'"]');r.find("input[type=checkbox]").prop("checked",!0),r.removeClass("hidden")}))},openModal:function(){var a=c.dhl_parcel_finder,e=a.getModal(),r=0<v(a.wrapper+" #shipping_country").val().length?v(a.wrapper+" #shipping_country").val():v(a.wrapper+" #billing_country").val();e.find("#dhl-parcelfinder-country").val(r);var p=0<v(a.wrapper+" #shipping_postcode").val().length?v(a.wrapper+" #shipping_postcode").val():v(a.wrapper+" #billing_postcode").val();e.find("#dhl-parcelfinder-postcode").val(p);var n=0<v(a.wrapper+" #shipping_city").val().length?v(a.wrapper+" #shipping_city").val():v(a.wrapper+" #billing_city").val();return e.find("#dhl-parcelfinder-city").val(n),e.addClass("open"),e.find("#dhl-parcel-finder-form").submit(),!1},closeModal:function(){return c.dhl_parcel_finder.getModal().removeClass("open"),!1},getModal:function(){return v("#dhl-parcel-finder-wrapper")},doAjax:function(a,r,e,p){var n=c.dhl_parcel_finder;e=e||n.onAjaxSuccess,p=p||n.onAjaxError,a.hasOwnProperty("security")||(a.security=n.params.parcel_finder_nonce),r.find("#dhl-parcel-finder-map").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),r.find(".notice-wrapper").empty(),v.ajax({type:"POST",url:n.params.ajax_url,data:a,success:function(a){a.success?(r.find("#dhl-parcel-finder-map").unblock(),e.apply(r,[a])):(p.apply(r,[a]),r.find("#dhl-parcel-finder-map").unblock(),a.hasOwnProperty("message")?n.addNotice(a.message,"error",r):a.hasOwnProperty("messages")&&v.each(a.messages,function(a,e){n.addNotice(e,"error",r)}))},error:function(a){},dataType:"json"})},onAjaxSuccess:function(a){},onAjaxError:function(a){},getFormData:function(a){var r={};return v.each(a.serializeArray(),function(a,e){-1!==e.name.indexOf("[]")?(e.name=e.name.replace("[]",""),r[e.name]=v.makeArray(r[e.name]),r[e.name].push(e.value)):r[e.name]=e.value}),r},onSubmit:function(a){var e=c.dhl_parcel_finder,r=c.dhl_parcel_locator,p=e.getModal().find("#dhl-parcel-finder"),n=p.find("form"),i=e.getFormData(n);return i.action="woocommerce_gzd_dhl_parcelfinder_search",i.is_checkout=r.isCheckout()?"yes":"no",e.doAjax(i,p,e.onSubmitSuccess),!1},onSubmitSuccess:function(a){var e=c.dhl_parcel_finder;a.parcel_shops&&(e.parcelShops=a.parcel_shops,"object"==typeof google&&"object"==typeof google.maps?e.updateMap():e.loadMapsAPI())},loadMapsAPI:function(){var a=c.dhl_parcel_finder;a.addScript("https://maps.googleapis.com/maps/api/js?key="+a.params.api_key,a.updateMap)},addScript:function(a,e){var r=document.createElement("script");e&&(r.onload=e),r.type="text/javascript",r.src=a,document.body.appendChild(r)},updateMap:function(){var u=c.dhl_parcel_finder,a=u.parcelShops,e={lat:a[0].location.latitude,lng:a[0].location.longitude},_=new google.maps.Map(document.getElementById("dhl-parcel-finder-map"),{zoom:13,center:e}),g=[];v.each(a,function(a,e){var r,p={lat:e.location.latitude,lng:e.location.longitude},n='<h5 class="parcel-subtitle">'+u.params.i18n.opening_times+"</h5>",i=0;v.each(e.psfTimeinfos,function(a,e){if("openinghour"===e.type){switch(e.weekday){case 1:r=u.params.i18n.monday;break;case 2:r=u.params.i18n.tueday;break;case 3:r=u.params.i18n.wednesday;break;case 4:r=u.params.i18n.thrusday;break;case 5:r=u.params.i18n.friday;break;case 6:r=u.params.i18n.satuday;break;case 7:r=u.params.i18n.sunday}i?i===e.weekday?n+=", ":n+="<br/>"+r+": ":n+=r+": ",i=e.weekday,n+=e.timefrom+" - "+e.timeto}});var o='<h5 class="parcel-subtitle">'+u.params.i18n.services+"</h5>",c=": "+u.params.i18n.no,t=": "+u.params.i18n.no;v.each(e.psfServicetypes,function(a,e){switch(e){case"parking":c=": "+u.params.i18n.yes;break;case"handicappedAccess":t=": "+u.params.i18n.yes}}),o+=u.params.i18n.parking+c+"<br/>",o+=u.params.i18n.handicap+t+"<br/>";var s=u.params.packstation_icon,l=u.params.i18n.packstation,d=u.params.i18n.packstation;switch(e.shopType){case"parcelShop":s=u.params.parcelshop_icon,l=u.params.i18n.parcelshop,d=u.params.i18n.branch;break;case"postOffice":s=u.params.postoffice_icon,l=u.params.i18n.postoffice,d=u.params.i18n.branch}var h='<div id="parcel-content"><div id="site-notice"></div><h4 class="parcel-title">'+(l+=" "+e.primaryKeyZipRegion)+'</h4><div id="bodyContent"><div>'+e.street+" "+e.houseNo+"</br>"+e.city+" "+e.zipCode+"</div>"+n+o+'<button type="button" class="dhl-parcelshop-select-btn" id="'+e.id+'">'+u.params.i18n.select+"</button></div></div>",m=new google.maps.InfoWindow({content:h,maxWidth:300});g.push(m);var f=new google.maps.Marker({position:p,map:_,title:d,animation:google.maps.Animation.DROP,icon:s});f.addListener("click",function(){!function e(){for(var a=0;a<g.length;a++)g[a].close()}(),m.open(_,f)})})},onSelectShop:function(){var p=c.dhl_parcel_finder,n=parseInt(v(this).attr("id")),i=p.params.i18n.packstation,o=v(p.wrapper+" #shipping_address_type");v.each(p.parcelShops,function(a,e){if(parseInt(e.id)===n){var r=!1;switch(e.shopType){case"packStation":i=p.params.i18n.packstation,r=!0;break;case"parcelShop":i=p.params.i18n.parcelshop;break;case"postOffice":i=p.params.i18n.postoffice}return v(p.wrapper+" #shipping_first_name").val(0<v(p.wrapper+" #shipping_first_name").val().length?v(p.wrapper+" #shipping_first_name").val():v(p.wrapper+" #billing_first_name").val()),v(p.wrapper+" #shipping_last_name").val(0<v(p.wrapper+" #shipping_last_name").val().length?v(p.wrapper+" #shipping_last_name").val():v(p.wrapper+" #billing_last_name").val()),v(p.wrapper+" #shipping_address_1").val(i+" "+e.primaryKeyZipRegion),v(p.wrapper+" #shipping_address_2").val(""),v(p.wrapper+" #shipping_postcode").val(e.zipCode),v(p.wrapper+" #shipping_city").val(e.city),o.val("dhl").trigger("change"),p.closeModal(),r&&""===v(p.wrapper+" #shipping_dhl_postnumber").val()&&v(p.wrapper+" #shipping_dhl_postnumber").focus(),!0}})},addNotice:function(a,e,r){r.find(".notice-wrapper").append('<div class="notice notice-'+e+'"><p>'+a+"</p></div>")}},v(document).ready(function(){c.dhl_parcel_finder.init()})}(jQuery,window.germanized);